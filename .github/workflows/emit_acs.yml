name: Emit ACS sample

on:
  workflow_dispatch:
  push:
    paths:
      - 'governance/guards/observability/metrics_sample.json'
      - 'governance/guards/observability/acs_metrics_emitter_v1.py'
      - '.github/workflows/emit_acs.yml'

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Sanity check
        run: |
          echo "== pwd ==" && pwd
          echo "== git HEAD ==" && git rev-parse --short HEAD
          echo "== list observability ==" && ls -la governance/guards/observability || true
          echo "== python ==" && python3 --version

      - name: Show sample input
        run: |
          echo "== Sample input =="
          cat governance/guards/observability/metrics_sample.json

      - name: Run ACS emitter on sample counters
        env:
          PYTHONUNBUFFERED: '1'
          METRICS_INPUT_JSON: governance/guards/observability/metrics_sample.json
        run: |
          echo "== Run emitter =="
          python3 governance/guards/observability/acs_metrics_emitter_v1.py
          echo "== End emitter =="
        continue-on-error: true
