name: Emit ACS sample

on:
  workflow_dispatch:
  push:
    paths:
      - 'governance/guards/observability/**'
      - '.github/workflows/emit_acs.yml'

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Sanity check
        run: |
          echo "== pwd ==" && pwd
          echo "== python ==" && python3 --version
          echo "== show HEAD ==" && git rev-parse --short HEAD
          echo "== list observability ==" && ls -la governance/guards/observability

      - name: Show sample input
        run: |
          echo "== Sample input =="
          cat governance/guards/observability/metrics_sample.json

      - name: Run ACS emitter on sample counters
        env:
          PYTHONUNBUFFERED: '1'
          PYTHONPATH: ${{ github.workspace }}
          METRICS_INPUT_JSON: governance/guards/observability/metrics_sample.json
        run: |
          echo "== Run emitter =="
          python3 -m governance.guards.observability.acs_metrics_emitter_v1
          echo "== End emitter =="
